    <html>
	<head>
		<title>Max's Apartment</title>
        <link href="{{ url_for('static', filename='css/bootstrap.min.css') }}" rel="stylesheet">
        <!--<link href="{{ url_for('static', filename='css/simple-slider.css') }}" rel="stylesheet">-->
        <link href="{{ url_for('static', filename='css/simple-slider-volume.css') }}" rel="stylesheet">
        <link href="{{ url_for('static', filename='css/styles.css') }}" rel="stylesheet">

        <style>

            .btn-group-wide {
                width: 100%;
            }

            .btn-up {
                border-bottom-right-radius: 0;
                border-bottom-left-radius: 0;
                border-bottom: 0px;
            }

            .btn-down {
                border-top-right-radius: 0;
                border-top-left-radius: 0;
                border-top: 0px;
            }

            .center {
                text-align: center;
            }

        </style>

	</head>
	<body>
        <div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
            <div class="container">
                <div class="navbar-header">
                    <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                        <span class="sr-only">Toggle navigation</span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>
                    <a class="navbar-brand" href="#">Max's Apartment</a>
                </div>
                <div class="navbar-collapse collapse">
                    <ul class="nav navbar-nav navbar-right">
                        <li class=""><a href="#" class="power-button" data-pwr="ON" id="power-ON">Power ON</a></li>
                        <li class=""><a href="#" class="power-button" data-pwr="OFF" id="power-STANDBY">Power OFF</a></li>
                    </ul>
                </div><!--/.nav-collapse -->
            </div>
        </div>

        <div class="container" style="margin-top: 80px;">
            <div class="row">
                <div class="col-sm-4">

                    <div class="row">
                        <div class="col-sm-12">

                            <div class="panel panel-info">
                                <div class="panel-heading">
                                    <h3 class="panel-title">Receiver</h3>
                                </div>
                                <div id="volume_value" class="h1 center-block" style="width: 50px; text-align: center; margin-top: 10px;">0</div>
                                <div class="panel-body">

                                    <div class="container-fluid">
                                        <div class="row">
                                            <div class="col-sm-12">
                                                <button class="btn btn-primary volume" id="volume_down">-</button>
                                                <div class="volume-bar">
                                                    <input id="volume-slide" type="text" data-slider="true"
                                                           data-slider-theme="volume" data-slider-range="0,79"
                                                           data-slider-step="0.5" data-slider-snap="true"
                                                           data-slider-highlight="true" />
                                                </div>
                                                <button class="btn btn-primary volume" style="margin-left: 10px;" id="volume_up">+</button>
                                            </div>
                                        </div>
                                        <div class="row" style="margin-top: 20px;">
                                            <div class="col-sm-6">
                                                <h4 class="center">Source Select</h4>
                                                <div class="btn-group-vertical btn-group-wide" id="toggle_sources" data-toggle="buttons">
                                                    <label id="SAT" class="btn btn-primary btn-block input_select">
                                                        <input id="input_roku" type="radio" name="source" value="SAT/CBL"> Roku
                                                    </label>
                                                    <label id="TV" class="btn btn-primary input_select">
                                                        <input id="input_wii" type="radio" name="source" value="TV"> Wii
                                                    </label>
                                                    <label id="BD" class="btn btn-primary input_select">
                                                        <input id="input_ps2" type="radio" name="source" value="BD"> PS2
                                                    </label>
                                                    <label id="GAME" class="btn btn-primary input_select">
                                                        <input id="input_xbox" type="radio" name="source" value="GAME"> Xbox
                                                    </label>
                                                    <label id="CD" class="btn btn-primary input_select">
                                                        <input id="input_atv" type="radio" name="source" value="CD"> AppleTV
                                                    </label>
                                                    <label id="MPLAY" class="btn btn-primary input_select">
                                                        <input id="input_chromecast" type="radio" name="source" name="MPLAY"> Chromecast
                                                    </label>
                                                    <label id="NETHOME" class="btn btn-primary input_select">
                                                        <input id="input_network" type="radio" name="source" value="NETHOME"> Network
                                                    </label>
                                                    <label id="AUX1" class="btn btn-primary input_select">
                                                        <input id="input_aux" type="radio" name="source" value="AUX1"> Aux
                                                    </label>
                                                </div>
                                            </div>
                                            <div class="col-sm-6">
                                                <h4 class="center">Sound Mode</h4>
                                                <div class="btn-group-vertical btn-group-wide" id="toggle_sound_mode" data-toggle="buttons">
                                                    <label id="sound_mode_AUTO_label" class="btn btn-primary sound_mode">
                                                        <input id="sound_mode_auto" type="radio" name="sound_mode" value="AUTO"> Auto
                                                    </label>
                                                    <label id="sound_mode_STEREO_label" class="btn btn-primary sound_mode">
                                                        <input id="sound_mode_stereo" type="radio" name="sound_mode" value="STEREO"> Stereo
                                                    </label>
                                                    <label id="sound_mode_MULTI_CH_STEREO_label" class="btn btn-primary sound_mode">
                                                        <input id="sound_mode_multi" type="radio" name="sound_mode" value="MCHSTEREO"> MultiCh Stereo
                                                    </label>
                                                    <label id="sound_mode_VIRTUAL_label" class="btn btn-primary sound_mode">
                                                        <input id="sound_mode_virtual" type="radio" name="sound_mode" value="VIRTUAL"> Virtual
                                                    </label>
                                                </div>

                                            </div>

                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-sm-12">
                            <div class="panel panel-info">
                                <div class="panel-heading">
                                    <h3 class="panel-title">Roku</h3>
                                </div>
                                <div class="panel-body" style="text-align: center">
                                    <div class="row">
                                        <div class="col-sm-12" style="text-align: center">
                                            <div class="btn-group">
                                                <button id="roku-back" class="btn btn-default btn-lg"><span class="glyphicon glyphicon-arrow-left"></span></button>
                                                <button id="roku-home" class="btn btn-default btn-lg"><span class="glyphicon glyphicon-home"></span></button>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="row" style="margin-top: 20px;">
                                        <div class="col-sm-4 col-sm-offset-4" style="text-align: center">
                                            <button id="roku-up" class="btn btn-default btn-lg btn-up"><span class="glyphicon glyphicon-chevron-up"></span></button>
                                        </div>
                                    </div>
                                    <div class="row">

                                        <div class="col-sm-12">
                                            <div class="btn-group">
                                                <button id="roku-left" class="btn btn-default btn-lg"><span class="glyphicon glyphicon-chevron-left"></span></button>
                                                <button id="roku-select" class="btn btn-default btn-lg"><span class="glyphicon glyphicon-ok"></span></button>
                                                <button id="roku-right" class="btn btn-default btn-lg"><span class="glyphicon glyphicon-chevron-right"></span></button>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-sm-4 col-sm-offset-4" style="text-align: center">
                                            <button id="roku-down" class="btn btn-default btn-lg btn-down"><span class="glyphicon glyphicon-chevron-down"></span></button>
                                        </div>
                                    </div>
                                    <div class="row" style="margin-top: 20px;">
                                        <div class="col-sm-12" style="text-align: center">
                                            <div class="btn-group">
                                                <button id="roku-instantreplay" class="btn btn-default btn-lg"><span class="glyphicon glyphicon-repeat"></span></button>
                                                <button id="roku-info" class="btn btn-default btn-lg"><span class="glyphicon glyphicon-asterisk"></span></button>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row" style="margin-top: 15px;">
                                        <div class="col-sm-12">
                                            <div class="btn-group">
                                                <button id="roku-rev" class="btn btn-default btn-lg"><span class="glyphicon glyphicon-backward"></span></button>
                                                <button id="roku-play" class="btn btn-default btn-lg"><span class="glyphicon glyphicon-play"></span></button>
                                                <button id="roku-fwd" class="btn btn-default btn-lg"><span class="glyphicon glyphicon-forward"></span></button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div><!-- /.col-sm-4 -->

                <div class="col-sm-8">
                    <div class="page-header" style="margin-top: 0px;">
                        <h1>Status</h1>
                    </div>
                    <table class="table">
                    <tr>
                        <td>Input</td>
                        <td id="table_input"></td>
                    </table>
                </div> 
            </div>

            <div class="row">
                <div class="col-sm-4">
                    
                </div><!-- /.col-sm-4 -->
            </div>
        </div>


		<script type="text/javascript" src="http://cdnjs.cloudflare.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>
		<script type="text/javascript" src="http://cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.3.1/jquery.cookie.min.js"></script>
		<script type="text/javascript" src="{{ url_for('static', filename='js/bootstrap.min.js') }}"></script>
		<script type="text/javascript" src="{{ url_for('static', filename='js/simple-slider.min.js') }}"></script>
		<script type="text/javascript">
            var slider = $("#volume-slide");
            slider.simpleSlider();

            slider.bind("slider:changed", function (event, data) {
                var vol = "PutMasterVolumeSet/" + (data.value - 80.0);
                console.log(vol);
                setVolume(vol);
                setTimeout(function(){
                    updateInfo(false);
                }, 50);

            });

            $('.input_select').on('click', function(event){

                var input = event.currentTarget.id;
                if (input === "SAT") {
                    input = "SAT/CBL";
                }

                var timeout = 50;
                console.log(input);
                if (input === "NETHOME" || input === "AUX1") {
                    timeout = 1500;
                }
                console.log(timeout);

                $.ajax({
                    type: 'POST',
                    url: '/set_source/',
                    data: JSON.stringify({"source": input}),
                    success: setTimeout(function(){updateInfo(false)}, timeout),
                    contentType: "application/json",
                    dataType: 'json'
                });
            });

            $('.sound_mode').on('click', function(event){
                var that = $(this);
                var mode = $("input", that).val();

                sendCmdThroughServer("PutSurroundMode/" + mode);
            });

            $("#roku-back").on('click', function(event){
                $.post("{{ roku_ip }}/keypress/back");
            });

            $("#roku-home").on('click', function(event){
                $.post("{{ roku_ip }}/keypress/home");
            });

            $("#roku-up").on('click', function(event){
                $.post("{{ roku_ip }}/keypress/up");
            });

            $("#roku-down").on('click', function(event){
                $.post("{{ roku_ip }}/keypress/down");
            });

            $("#roku-left").on('click', function(event){
                $.post("{{ roku_ip }}/keypress/left");
            });

            $("#roku-right").on('click', function(event){
                $.post("{{ roku_ip }}/keypress/right");
            });

            $("#roku-select").on('c', function(event){
                $.post("{{ roku_ip }}/keypress/select");
            });

            $("#roku-instantreplay").on('click', function(event){
                $.post("{{ roku_ip }}/keypress/instantreplay");
            });

            $("#roku-info").on('click', function(event){
                $.post("{{ roku_ip }}/keypress/info");
            });

            $("#roku-rev").on('click', function(event){
                $.post("{{ roku_ip }}/keypress/rev");
            });

            $("#roku-fwd").on('click', function(event){
                $.post("{{ roku_ip }}/keypress/fwd");
            });

            $("#roku-play").on('click', function(event){
                $.post("{{ roku_ip }}/keypress/play");
            });

			$(document).ready(function(){
				$.cookie("ZoneName", "MAIN%20ZONE");
				updateInfo(true);

				$('.volume').bind('click', function(event){
                    var that = $(this);
                    var action;
                    if (that.attr('id') == 'volume_up'){
                        action = "PutMasterVolumeBtn/>";
                    }
                    else if(that.attr('id') == 'volume_down'){
                        action = "PutMasterVolumeBtn/<"
                    }
                    setVolume(action);
                    updateInfo(true);
				});

                $('.power-button').bind('click', function(event){
                    var that = $(this);
                    var val = that.data('pwr');
                    sendCmd("PutZone_OnOff/" + val);
                    updateInfo(false);
                });
			});

            function setVolume(vol) {
                var that = $(this);
                that.attr('disabled', 'disabled');
                sendCmd(vol, function(){
                    that.removeAttr('disabled');
                });
            }

			function updateInfo(set_slider){
                $('.power-button').each(function(index, value){
                    $(this).parent().removeClass('active');
                });
				$.ajax({
					url: "/data/",
					type: "GET",
					dataType: "json",
					success: function(data,status){
						
                        var vol = parseFloat(data.volume);
                        var input_source = data.input_source;
                        var power_status = data.power_status;
                        var sound_mode = data.sound_mode;

                        $("#power-" + power_status).parent().addClass('active');

                        $("#volume_value").html(vol);
                        if(set_slider){
                            slider.simpleSlider("setValue", vol);
                        }

                        $("#input_source").html(input_source);
                        $("#table_input").html(input_source);


                        if (input_source === "Roku"){
                            $("#SAT").addClass("active");
                        } else if (input_source === "PS 2") {
                            $("#BD").addClass("active");
                        } else if (input_source === "XBOX") {
                            $("#GAME").addClass("active");
                        } else if (input_source === "Apple TV") {
                            $("#CD").addClass("active");
                        } else if (input_source === "ChromeCast") {
                            $("#MPLAY").addClass("active");
                        } else if (input_source === "NETWORK") {
                            $("#NETHOME").addClass("active");
                        } else if (input_source === "Front") {
                            $("#AUX1").addClass("active");
                        } else if (input_source === "Wii") {
                            $("#TV").addClass("active");
                        }

                        $("#sound_mode_" + sound_mode + "_label").addClass("active");
					}
				});
			}

            function sendCmd(cmd, callback) {
                $.post("http://172.16.2.220/MainZone/index.put.asp", {cmd0: cmd}, {crossdomain: true}).always(callback);
            }

            function sendCmdThroughServer(cmd) {
                $.ajax({
                    type: "POST",
                    url: "/send/",
                    data: JSON.stringify({cmd: cmd}),
                    contentType: "application/json",
                    dataType: 'json'
                });
            }

		</script>
	</body>
</html>
